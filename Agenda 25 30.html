<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Agenda 2025-2030</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: url('https://campushome.es/wp-content/uploads/2024/07/elegir-mejor-horario-estudio-1024x683.webp') no-repeat center center fixed;
      background-size: cover;
      padding: 20px;
      text-align: center;
      color: #222;
    }
    h1 { margin-bottom: 6px; color: #fff; text-shadow: 2px 2px 5px #000; }
    #clock {
      font-size: 24px; font-weight: bold; color: #fff;
      background: rgba(0,0,0,0.6); display: inline-block;
      padding: 8px 16px; border-radius: 10px; margin-bottom: 16px;
    }
    #yearSelect { margin: 12px; padding: 8px; font-size: 16px; }

    .year { display: none; }
    .calendar {
      display: grid;
      grid-template-columns: repeat(3, 1fr); /* 3 columnas */
      gap: 20px;
      margin-bottom: 40px;
      justify-items: center;
    }
    .month {
      background: rgba(255,255,255,0.9);
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      width: 300px;
    }
    .month h3 {
      margin: 4px 0 8px; text-align: center;
      background: #eee; border-radius: 8px; padding: 6px;
    }

    table { width: 100%; border-collapse: collapse; }
    thead th {
      background: #2ecc71; /* verde para la fila de d√≠as de la semana */
      color: #fff;
      font-size: 12px;
      padding: 4px;         /* m√°s peque√±o que las celdas de d√≠as */
      text-align: center;
      border: 1px solid #2fb965;
    }
    tbody td {
      width: 14.285%;
      height: 70px;         /* m√°s grande para escribir notas */
      border: 1px solid #ccc;
      vertical-align: top;
      text-align: right;
      padding: 4px;
      cursor: pointer;
      position: relative;
      background: #fff;
    }
    td.has-note { background: #fff8b3 !important; } /* amarillo suave cuando hay nota */

    /* Modal */
    #noteModal {
      display: none; position: fixed; inset: 0;
      background: rgba(0,0,0,0.5); z-index: 1000;
      align-items: center; justify-content: center;
    }
    #noteModalContent {
      background: #fff; width: 320px; padding: 16px;
      border-radius: 10px; box-shadow: 0 6px 16px rgba(0,0,0,0.4);
      text-align: center;
    }
    #noteText { width: 100%; height: 120px; margin: 8px 0; }
    .btn { padding: 6px 12px; margin: 4px; border: none; border-radius: 6px; cursor: pointer; }
    .btn-save { background: #4caf50; color: #fff; }
    .btn-del  { background: #e53935; color: #fff; }
    .btn-close{ background: #666;    color: #fff; }
  </style>
</head>
<body>
  <h1>üìÖ Agenda 2025 - 2030</h1>
  <div id="clock"></div>

  <div>
    <label for="yearSelect"><b>Selecciona un a√±o:</b></label>
    <select id="yearSelect"></select>
  </div>

  <div id="calendars"></div>

  <!-- Modal de notas -->
  <div id="noteModal">
    <div id="noteModalContent">
      <h3 id="noteDate"></h3>
      <textarea id="noteText" placeholder="Escribe tu nota..."></textarea><br />
      <button class="btn btn-save"  id="saveNote">Guardar</button>
      <button class="btn btn-del"   id="deleteNote">Borrar</button>
      <button class="btn btn-close" id="closeModal">Cerrar</button>
    </div>
  </div>

  <script>
    // Configuraci√≥n
    const START_YEAR = 2025, END_YEAR = 2030;
    const MONTHS_ES = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
    const DAYS_ES   = ["Lun","Mar","Mi√©","Jue","Vie","S√°b","Dom"]; // lunes primero

    // Estado de notas en localStorage (un √∫nico objeto)
    const STORAGE_KEY = "agendaNotes";
    let notes = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");

    // Elementos
    const calendarsDiv = document.getElementById("calendars");
    const yearSelect   = document.getElementById("yearSelect");
    const modal        = document.getElementById("noteModal");
    const noteText     = document.getElementById("noteText");
    const noteDateLbl  = document.getElementById("noteDate");
    const saveBtn      = document.getElementById("saveNote");
    const delBtn       = document.getElementById("deleteNote");
    const closeBtn     = document.getElementById("closeModal");

    let currentKey = ""; // YYYY-MM-DD

    // Reloj
    function actualizarReloj() {
      const now = new Date();
      const fecha = now.toLocaleDateString("es-ES", { weekday:"long", year:"numeric", month:"long", day:"numeric" });
      const hh = String(now.getHours()).padStart(2,"0");
      const mm = String(now.getMinutes()).padStart(2,"0");
      const ss = String(now.getSeconds()).padStart(2,"0");
      document.getElementById("clock").textContent = `${hh}:${mm}:${ss} ‚Äî ${fecha}`;
    }
    setInterval(actualizarReloj, 1000); actualizarReloj();

    // Utilidad: pad dos d√≠gitos
    const pad2 = n => String(n).padStart(2,"0");

    // Crear selector de a√±os
    for (let y = START_YEAR; y <= END_YEAR; y++) {
      const opt = document.createElement("option");
      opt.value = y; opt.textContent = y;
      yearSelect.appendChild(opt);
    }
    yearSelect.value = START_YEAR;

    // Generar todos los a√±os (se ocultan; se muestra s√≥lo el seleccionado)
    function buildAllYears() {
      for (let y = START_YEAR; y <= END_YEAR; y++) {
        const yearDiv = document.createElement("div");
        yearDiv.className = "year";
        yearDiv.id = `year-${y}`;

        const grid = document.createElement("div");
        grid.className = "calendar";

        for (let m = 0; m < 12; m++) {
          const monthDiv = document.createElement("div");
          monthDiv.className = "month";
          monthDiv.innerHTML = `<h3>${MONTHS_ES[m]} ${y}</h3>`;

          const table = document.createElement("table");

          // Encabezado (verde) con lunes primero
          const thead = document.createElement("thead");
          const trH = document.createElement("tr");
          DAYS_ES.forEach(d => {
            const th = document.createElement("th");
            th.textContent = d;
            trH.appendChild(th);
          });
          thead.appendChild(trH);
          table.appendChild(thead);

          const tbody = document.createElement("tbody");

          // C√°lculo con semana que inicia en lunes
          const jsFirstDay = new Date(y, m, 1).getDay(); // 0=Dom .. 6=S√°b
          const firstCol = (jsFirstDay + 6) % 7; // 0=Lun .. 6=Dom
          const daysInMonth = new Date(y, m + 1, 0).getDate();

          let tr = document.createElement("tr");
          // celdas vac√≠as antes del 1
          for (let i = 0; i < firstCol; i++) tr.appendChild(document.createElement("td"));

          for (let d = 1; d <= daysInMonth; d++) {
            if (tr.children.length === 7) { tbody.appendChild(tr); tr = document.createElement("tr"); }
            const td = document.createElement("td");
            td.textContent = d;

            const key = `${y}-${pad2(m+1)}-${pad2(d)}`; // YYYY-MM-DD
            td.setAttribute("data-date", key);

            if (notes[key]) td.classList.add("has-note");

            td.addEventListener("click", () => openModal(key));
            tr.appendChild(td);
          }
          // rellenar celdas vac√≠as al final
          while (tr.children.length < 7) tr.appendChild(document.createElement("td"));
          tbody.appendChild(tr);

          table.appendChild(tbody);
          monthDiv.appendChild(table);
          grid.appendChild(monthDiv);
        }

        yearDiv.appendChild(grid);
        calendarsDiv.appendChild(yearDiv);
      }
    }

    function showYear(y) {
      document.querySelectorAll(".year").forEach(div => div.style.display = "none");
      const target = document.getElementById(`year-${y}`);
      if (target) target.style.display = "block";
    }

    function openModal(key) {
      currentKey = key;
      noteDateLbl.textContent = `Nota para ${key}`;
      noteText.value = notes[key] || "";
      modal.style.display = "flex";
    }
    function closeModal() { modal.style.display = "none"; }

    function saveNotesToStorage() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(notes));
    }

    // Guardar / borrar nota (marca s√≥lo esa celda exacta por data-date)
    function saveNote() {
      const text = noteText.value.trim();
      if (text) notes[currentKey] = text;
      else delete notes[currentKey];
      saveNotesToStorage();

      const cell = document.querySelector(`td[data-date="${currentKey}"]`);
      if (cell) {
        if (text) cell.classList.add("has-note");
        else cell.classList.remove("has-note");
      }
      closeModal();
    }
    function deleteNote() {
      delete notes[currentKey];
      saveNotesToStorage();
      const cell = document.querySelector(`td[data-date="${currentKey}"]`);
      if (cell) cell.classList.remove("has-note");
      noteText.value = "";
      closeModal();
    }

    // Eventos
    saveBtn.addEventListener("click", saveNote);
    delBtn.addEventListener("click", deleteNote);
    closeBtn.addEventListener("click", closeModal);
    modal.addEventListener("click", e => { if (e.target === modal) closeModal(); });
    yearSelect.addEventListener("change", () => showYear(yearSelect.value));

    // Inicializar
    buildAllYears();
    showYear(START_YEAR);
  </script>
</body>
</html>
